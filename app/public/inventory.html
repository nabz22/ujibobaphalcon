<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management - Products CRUD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            font-weight: bold;
            color: #333;
            background: #f8f9fa;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            text-align: center;
            color: #667eea;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header-controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                text-align: center;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì¶ Inventory Management - Products</h1>
            <p style="color: #666; margin-top: 10px;">Manage product inventory with Odoo integration</p>
            <div class="header-controls">
                <button class="btn btn-primary" onclick="showAddProductModal()">‚ûï Add New Product</button>
                <button class="btn btn-success" onclick="syncFromOdoo()">üîÑ Sync from Odoo</button>
            </div>
        </header>

        <div class="main-content">
            <!-- Sidebar: Stats & Quick Actions -->
            <div>
                <div class="card">
                    <div class="card-title">üìä Statistics</div>
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value" id="totalProducts">0</div>
                            <div class="stat-label">Total Products</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="lowStockCount">0</div>
                            <div class="stat-label">Low Stock</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <div class="card-title">üîç Filter</div>
                    <div class="form-group">
                        <label>Search Product</label>
                        <input type="text" id="searchInput" placeholder="Search by name or code..." onkeyup="filterProducts()">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="statusFilter" onchange="filterProducts()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="categoryFilter" onchange="filterProducts()">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Main Content: Product List -->
            <div>
                <div class="card">
                    <div class="card-title">üìã Product List</div>
                    <div id="alertContainer"></div>
                    <div id="loadingIndicator" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading products...</p>
                    </div>
                    <div class="table-responsive" id="tableContainer" style="display: none;">
                        <table id="productsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Code</th>
                                    <th>Category</th>
                                    <th>List Price</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add/Edit Product -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeProductModal()">&times;</span>
            <div class="modal-header" id="modalTitle">Add New Product</div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">

                <div class="form-group">
                    <label for="productName">Product Name *</label>
                    <input type="text" id="productName" required>
                </div>

                <div class="form-group">
                    <label for="productCode">SKU/Code</label>
                    <input type="text" id="productCode">
                </div>

                <div class="form-group">
                    <label for="productCategory">Category</label>
                    <input type="text" id="productCategory">
                </div>

                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription"></textarea>
                </div>

                <div class="form-group">
                    <label for="productListPrice">List Price</label>
                    <input type="number" id="productListPrice" step="0.01" min="0">
                </div>

                <div class="form-group">
                    <label for="productCostPrice">Cost Price</label>
                    <input type="number" id="productCostPrice" step="0.01" min="0">
                </div>

                <div class="form-group">
                    <label for="productQuantity">Quantity on Hand</label>
                    <input type="number" id="productQuantity" step="0.01" min="0">
                </div>

                <div class="form-group">
                    <label for="productUom">Unit of Measurement</label>
                    <input type="text" id="productUom" placeholder="e.g., Unit, Box, Kg">
                </div>

                <div class="form-group">
                    <label for="productStatus">Status</label>
                    <select id="productStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">Save Product</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeProductModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = '/api/inventory';
        let allProducts = [];
        let filteredProducts = [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });

        // Load all products
        async function loadProducts() {
            showLoading(true);
            clearAlert();

            try {
                const response = await fetch(`${API_BASE}/products`);
                const data = await response.json();

                if (data.status === 'success') {
                    allProducts = data.data || [];
                    filteredProducts = [...allProducts];
                    renderProducts();
                    updateStats();
                    populateCategories();
                } else {
                    showAlert('Error loading products: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Failed to load products: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Render products in table
        function renderProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = '';

            if (filteredProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">No products found</td></tr>';
                return;
            }

            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                const statusBadge = `<span class="status-badge status-${product.status}">${product.status}</span>`;

                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.code || '-'}</td>
                    <td>${product.category || '-'}</td>
                    <td>Rp ${parseFloat(product.list_price).toLocaleString('id-ID')}</td>
                    <td>${product.quantity_on_hand} ${product.uom || 'unit'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="editProduct(${product.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct(${product.id})">Delete</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalProducts').textContent = allProducts.length;
            const lowStock = allProducts.filter(p => p.quantity_on_hand < 10).length;
            document.getElementById('lowStockCount').textContent = lowStock;
        }

        // Populate category filter
        function populateCategories() {
            const categories = [...new Set(allProducts.map(p => p.category).filter(Boolean))];
            const select = document.getElementById('categoryFilter');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        }

        // Filter products
        function filterProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const category = document.getElementById('categoryFilter').value;

            filteredProducts = allProducts.filter(product => {
                const matchSearch = !search || 
                    product.name.toLowerCase().includes(search) || 
                    (product.code && product.code.toLowerCase().includes(search));
                const matchStatus = !status || product.status === status;
                const matchCategory = !category || product.category === category;

                return matchSearch && matchStatus && matchCategory;
            });

            renderProducts();
        }

        // Show add product modal
        function showAddProductModal() {
            document.getElementById('productId').value = '';
            document.getElementById('productForm').reset();
            document.getElementById('modalTitle').textContent = 'Add New Product';
            document.getElementById('productModal').classList.add('show');
        }

        // Close modal
        function closeProductModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        // Edit product
        async function editProduct(id) {
            const product = allProducts.find(p => p.id == id);
            if (!product) {
                showAlert('Product not found', 'error');
                return;
            }

            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.name;
            document.getElementById('productCode').value = product.code || '';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productListPrice').value = product.list_price;
            document.getElementById('productCostPrice').value = product.cost_price;
            document.getElementById('productQuantity').value = product.quantity_on_hand;
            document.getElementById('productUom').value = product.uom || '';
            document.getElementById('productStatus').value = product.status;

            document.getElementById('modalTitle').textContent = 'Edit Product';
            document.getElementById('productModal').classList.add('show');
        }

        // Save product (create or update)
        async function saveProduct(event) {
            event.preventDefault();

            const productId = document.getElementById('productId').value;
            const formData = {
                name: document.getElementById('productName').value,
                code: document.getElementById('productCode').value,
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                list_price: parseFloat(document.getElementById('productListPrice').value) || 0,
                cost_price: parseFloat(document.getElementById('productCostPrice').value) || 0,
                quantity_on_hand: parseFloat(document.getElementById('productQuantity').value) || 0,
                uom: document.getElementById('productUom').value,
                status: document.getElementById('productStatus').value
            };

            try {
                let url, method = 'POST';
                if (productId) {
                    url = `${API_BASE}/products/update/${productId}`;
                } else {
                    url = `${API_BASE}/products/create`;
                }

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showAlert(data.message, 'success');
                    closeProductModal();
                    loadProducts();
                } else {
                    showAlert('Error: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Failed to save product: ' + error.message, 'error');
            }
        }

        // Delete product
        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/products/delete/${id}`);
                const data = await response.json();

                if (data.status === 'success') {
                    showAlert(data.message, 'success');
                    loadProducts();
                } else {
                    showAlert('Error: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Failed to delete product: ' + error.message, 'error');
            }
        }

        // Sync products from Odoo
        async function syncFromOdoo() {
            if (!confirm('This will sync products from Odoo. Continue?')) {
                return;
            }

            showLoading(true);
            clearAlert();

            try {
                const response = await fetch(`${API_BASE}/products/sync-odoo`);
                const data = await response.json();

                if (data.status === 'success') {
                    const summary = data.summary;
                    const msg = `Sync completed! Created: ${summary.created}, Updated: ${summary.updated}, Errors: ${summary.errors_count}`;
                    showAlert(msg, 'success');
                    loadProducts();
                } else {
                    showAlert('Sync failed: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Sync error: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Show/hide loading indicator
        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            const table = document.getElementById('tableContainer');
            
            if (show) {
                loading.style.display = 'block';
                table.style.display = 'none';
            } else {
                loading.style.display = 'none';
                table.style.display = 'block';
            }
        }

        // Show alert message
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);

            setTimeout(() => alert.remove(), 5000);
        }

        // Clear alerts
        function clearAlert() {
            document.getElementById('alertContainer').innerHTML = '';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target == modal) {
                modal.classList.remove('show');
            }
        }
    </script>
</body>
</html>
